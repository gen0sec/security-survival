<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>SERVER: Survival Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

      const SUPABASE_URL = window.__SUPABASE_URL__;
      const SUPABASE_ANON_KEY = window.__SUPABASE_ANON_KEY__;

      if (SUPABASE_URL && SUPABASE_ANON_KEY) {
        window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        window.supabaseEnabled = true;
        console.log("Supabase enabled");
      } else {
        window.supabaseEnabled = false;
        console.warn("Supabase disabled (no config)");
      }
    </script>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- UI Overlay: Top Bar -->
    <div class="absolute top-0 left-0 w-full h-full pointer-events-none z-20">
      <!-- Stats Panel (Top Left) -->
      <div
        id="statsPanel"
        class="absolute top-4 left-4 glass-panel rounded-xl p-5 w-80 pointer-events-auto"
      >
        <div
          class="flex justify-between items-end mb-3 border-b border-gray-700 pb-2"
        >
          <h1
            class="text-2xl font-bold text-red-500 tracking-widest animate-pulse"
          >
            SURVIVAL
          </h1>
          <span class="text-xs text-gray-500 font-mono">v2.1</span>
        </div>

        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <span class="text-gray-400 text-sm">BUDGET</span>
            <span
              id="money-display"
              class="text-green-400 font-mono text-xl font-bold transition-colors duration-300"
              >$500</span
            >
          </div>
          <div class="flex justify-between items-center text-xs">
            <span class="text-gray-500">Upkeep Cost</span>
            <span id="upkeep-display" class="text-red-400 font-mono"
              >-$0.00/s</span
            >
          </div>
          <div class="flex justify-between items-center text-xs">
            <span class="text-gray-500">Elapsed Time</span>
            <span id="elapsed-time" class="text-gray-400 font-mono">00:00</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400 text-sm">REPUTATION</span>
            <div class="flex items-center gap-2">
              <div
                class="w-24 h-3 bg-gray-800 rounded-full overflow-hidden relative"
              >
                <div
                  id="rep-bar"
                  class="h-full bg-yellow-500 transition-all duration-500"
                  style="width: 100%"
                ></div>
              </div>
              <span
                id="rep-display"
                class="text-yellow-400 font-mono text-sm w-10 text-right"
                >100%</span
              >
            </div>
          </div>
          <div class="flex justify-between items-center pt-1">
            <span class="text-gray-400 text-sm">LOAD (RPS)</span>
            <span id="rps-display" class="text-blue-300 font-mono text-sm"
              >0.0 req/s</span
            >
          </div>
          <div
            class="flex justify-between items-center text-xs"
            id="rps-milestone-row"
          >
            <span class="text-gray-500">Next RPS Surge</span>
            <div class="flex items-center gap-2 font-mono">
              <span id="rps-next" class="text-orange-400">√ó1.0</span>
              <span class="text-gray-600">in</span>
              <span id="rps-countdown" class="text-cyan-400">0:00</span>
            </div>
          </div>
          <div class="flex justify-between items-center pt-1">
            <span class="text-gray-400 text-sm">TRAFFIC</span>
            <div class="flex gap-1 text-[10px] font-mono">
              <span class="text-green-400" id="mix-static" title="Static GET"
                >ST</span
              >
              <span class="text-blue-400" id="mix-read" title="Read GET"
                >RD</span
              >
              <span class="text-orange-400" id="mix-write" title="Write POST"
                >WR</span
              >
              <span class="text-yellow-400" id="mix-upload" title="Upload"
                >UP</span
              >
              <span class="text-cyan-400" id="mix-search" title="Search"
                >SR</span
              >
              <span class="text-red-400" id="mix-malicious" title="Malicious"
                >‚ö†Ô∏è</span
              >
            </div>
          </div>

          <!-- Failures Table -->
          <div
            id="failures-panel"
            class="mt-2 pt-2 border-t border-gray-700/50 hidden"
          >
            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-500 text-xs uppercase">Failures</span>
              <span id="failures-total" class="text-red-400 font-mono text-xs"
                >0 total</span
              >
            </div>
            <table class="w-full text-[10px] font-mono">
              <thead>
                <tr class="text-gray-500">
                  <th class="text-left font-normal">Type</th>
                  <th class="text-right font-normal">Count</th>
                  <th class="text-right font-normal">Rep Loss</th>
                </tr>
              </thead>
              <tbody id="failures-tbody">
                <tr class="text-purple-400" id="fail-row-malicious">
                  <td>üõ°Ô∏è Fraud Leak</td>
                  <td class="text-right" id="fail-malicious">0</td>
                  <td class="text-right text-red-400" id="fail-malicious-rep">
                    0
                  </td>
                </tr>
                <tr class="text-green-400" id="fail-row-static">
                  <td>ST Static</td>
                  <td class="text-right" id="fail-static">0</td>
                  <td class="text-right text-red-400" id="fail-static-rep">
                    0
                  </td>
                </tr>
                <tr class="text-blue-400" id="fail-row-read">
                  <td>RD Read</td>
                  <td class="text-right" id="fail-read">0</td>
                  <td class="text-right text-red-400" id="fail-read-rep">0</td>
                </tr>
                <tr class="text-orange-400" id="fail-row-write">
                  <td>WR Write</td>
                  <td class="text-right" id="fail-write">0</td>
                  <td class="text-right text-red-400" id="fail-write-rep">0</td>
                </tr>
                <tr class="text-yellow-400" id="fail-row-upload">
                  <td>UP Upload</td>
                  <td class="text-right" id="fail-upload">0</td>
                  <td class="text-right text-red-400" id="fail-upload-rep">
                    0
                  </td>
                </tr>
                <tr class="text-cyan-400" id="fail-row-search">
                  <td>SR Search</td>
                  <td class="text-right" id="fail-search">0</td>
                  <td class="text-right text-red-400" id="fail-search-rep">
                    0
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div
            class="flex justify-between items-center pt-3 border-t border-gray-700 mt-2"
          >
            <span class="text-gray-300 font-bold text-lg">TOTAL SCORE</span>
            <span
              id="total-score-display"
              class="text-white font-mono text-2xl font-bold"
              >0</span
            >
          </div>
        </div>
      </div>

      <div
        class="absolute top-4 right-4 flex flex-col gap-3 items-end pointer-events-none"
      >
        <!-- Score Details Panel (Top Right) -->
        <div
          id="detailsPanel"
          class="glass-panel rounded-xl p-4 w-60 pointer-events-auto"
        >
          <h3
            class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 border-b border-gray-700 pb-1"
          >
            Traffic Score Details
          </h3>
          <div class="space-y-1 text-sm font-mono">
            <div class="flex justify-between items-center">
              <span class="text-gray-500">Storage (S3)</span>
              <span id="score-storage" class="text-emerald-300">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-500">Database (SQL)</span>
              <span id="score-database" class="text-red-300">0</span>
            </div>
            <div
              class="flex justify-between items-center pt-1 border-t border-gray-800"
            >
              <span class="text-purple-300 font-bold">ATTACKS BLOCKED</span>
              <span id="score-malicious" class="text-purple-300">0</span>
            </div>
          </div>
        </div>

        <!-- Service Health Panel (Under Score Details) -->
        <div
          id="healthPanel"
          class="glass-panel rounded-xl p-4 w-72 pointer-events-auto transition-all duration-300"
        >
          <div
            class="flex justify-between items-center mb-2 border-b border-gray-700 pb-1"
          >
            <h3 class="text-xs font-bold text-red-400 uppercase tracking-wider">
              Service Health
            </h3>
            <div class="flex items-center gap-2">
              <button
                id="auto-repair-toggle"
                onclick="toggleAutoRepair()"
                class="px-2 py-0.5 rounded text-xs font-mono bg-gray-700 text-gray-400 hover:bg-gray-600 transition"
                title="Auto-repair services (+10% upkeep)"
              >
                Auto-Repair: OFF
              </button>
              <button
                onclick="togglePanel('health-panel-content', 'health-panel-icon')"
                class="w-6 h-6 flex items-center justify-center bg-gray-800 hover:bg-gray-700 rounded border border-gray-600 text-gray-400 transition"
              >
                <span id="health-panel-icon" class="text-[10px]">‚ñ≤</span>
              </button>
            </div>
          </div>
          <div id="health-panel-content">
            <div id="service-health-list" class="text-sm font-mono mb-2">
              <div class="text-green-400 text-xs">All services healthy</div>
            </div>
            <div
              id="repair-cost-table"
              class="text-xs border-t border-gray-700 pt-2 hidden"
            >
              <div class="grid grid-cols-3 gap-1 text-gray-500 mb-1">
                <span>Service</span>
                <span class="text-center">Repair</span>
                <span class="text-right">Auto Repair/min</span>
              </div>
              <div id="repair-cost-rows" class="space-y-0.5"></div>
            </div>
            <div
              class="text-xs text-gray-500 mt-2 pt-2 border-t border-gray-700 space-y-1"
            >
              <div>üîß Click damaged services to repair manually</div>
              <div>
                ‚ö° Auto-Repair: Heals services at 10% of service cost/min
              </div>
            </div>
          </div>
        </div>

        <!-- Finances Panel (Under Service Health) -->
        <div
          id="financesPanel"
          class="glass-panel rounded-xl p-4 w-72 pointer-events-auto transition-all duration-300"
        >
          <div
            class="flex justify-between items-center mb-2 border-b border-gray-700 pb-1"
          >
            <h3
              class="text-xs font-bold text-green-400 uppercase tracking-wider"
            >
              Finances
            </h3>
            <button
              onclick="togglePanel('finances-panel-content', 'finances-panel-icon')"
              class="w-6 h-6 flex items-center justify-center bg-gray-800 hover:bg-gray-700 rounded border border-gray-600 text-gray-400 transition"
            >
              <span id="finances-panel-icon" class="text-[10px]">‚ñ≤</span>
            </button>
          </div>

          <div id="finances-panel-content">
            <!-- Income Section -->
            <div class="mb-3">
              <div class="text-xs text-gray-500 mb-1 flex justify-between">
                <span>Income by Request Type</span>
                <span id="income-total" class="text-green-400 font-bold"
                  >$0</span
                >
              </div>
              <div
                id="income-details"
                class="space-y-0.5 text-xs pl-2 border-l border-gray-700"
              >
                <!-- Dynamic rows will be inserted here -->
              </div>
            </div>

            <!-- Expenses Section -->
            <div class="mb-3">
              <div class="text-xs text-gray-500 mb-1 flex justify-between">
                <span>Expenses Breakdown</span>
                <span id="expense-total" class="text-red-400 font-bold"
                  >$0</span
                >
              </div>
              <div
                id="expense-details"
                class="space-y-0.5 text-xs pl-2 border-l border-gray-700"
              >
                <!-- Dynamic rows will be inserted here -->
              </div>
            </div>

            <!-- Net Profit -->
            <div class="border-t border-gray-700 pt-2 mt-2">
              <div class="grid grid-cols-2 gap-1 text-xs">
                <span class="text-gray-300 font-bold">Net Profit</span>
                <span
                  id="net-profit"
                  class="text-right font-bold text-yellow-400"
                  >$0</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Active Event Indicator Bar -->
      <div
        id="active-event-bar"
        class="fixed top-0 left-0 right-0 h-8 z-40 hidden"
      >
        <div
          class="h-full flex items-center justify-center gap-3 text-white font-bold text-sm event-active-bar"
        >
          <span id="active-event-icon">‚ö°</span>
          <span id="active-event-text">EVENT ACTIVE</span>
          <span
            id="active-event-timer"
            class="font-mono bg-black/30 px-2 rounded"
          ></span>
        </div>
        <div
          id="active-event-progress"
          class="absolute bottom-0 left-0 h-1 bg-white/50 transition-all duration-100"
          style="width: 100%"
        ></div>
      </div>

      <!-- Intervention Warnings Container (Center Top) -->
      <div
        id="intervention-warnings"
        class="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 pointer-events-none flex flex-col items-center"
      ></div>

      <!-- Time Control Panel (Top Center) -->
      <div
        class="absolute top-4 left-1/2 transform -translate-x-1/2 glass-panel rounded-xl p-2 pointer-events-auto flex gap-2"
      >
        <button
          onclick="saveGameState()"
          id="btn-save"
          class="time-btn w-10 h-10 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:border-green-500 hover:text-green-400 flex items-center justify-center"
          title="Save Game"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 7H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"
            ></path>
          </svg>
        </button>
        <button
          onclick="restartGame()"
          id="btn-restart"
          class="time-btn w-10 h-10 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:border-red-500 hover:text-red-400 flex items-center justify-center"
          title="Restart Game"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            ></path>
          </svg>
        </button>
        <button
          onclick="openSettings()"
          id="btn-settings"
          class="time-btn w-10 h-10 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:border-red-500 hover:text-red-400 flex items-center justify-center mr-2"
          title="Settings"
        >
          <svg
            viewBox="0 0 24 24"
            class="w-4 h-4"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g
              id="SVGRepo_tracerCarrier"
              stroke-linecap="round"
              stroke-linejoin="round"
            ></g>
            <g id="SVGRepo_iconCarrier">
              <circle
                cx="12"
                cy="12"
                r="3"
                stroke="currentColor"
                stroke-width="1.5"
              ></circle>
              <path
                d="M3.66122 10.6392C4.13377 10.9361 4.43782 11.4419 4.43782 11.9999C4.43781 12.558 4.13376 13.0638 3.66122 13.3607C3.33966 13.5627 3.13248 13.7242 2.98508 13.9163C2.66217 14.3372 2.51966 14.869 2.5889 15.3949C2.64082 15.7893 2.87379 16.1928 3.33973 16.9999C3.80568 17.8069 4.03865 18.2104 4.35426 18.4526C4.77508 18.7755 5.30694 18.918 5.83284 18.8488C6.07287 18.8172 6.31628 18.7185 6.65196 18.5411C7.14544 18.2803 7.73558 18.2699 8.21895 18.549C8.70227 18.8281 8.98827 19.3443 9.00912 19.902C9.02332 20.2815 9.05958 20.5417 9.15224 20.7654C9.35523 21.2554 9.74458 21.6448 10.2346 21.8478C10.6022 22 11.0681 22 12 22C12.9319 22 13.3978 22 13.7654 21.8478C14.2554 21.6448 14.6448 21.2554 14.8478 20.7654C14.9404 20.5417 14.9767 20.2815 14.9909 19.9021C15.0117 19.3443 15.2977 18.8281 15.7811 18.549C16.2644 18.27 16.8545 18.2804 17.3479 18.5412C17.6837 18.7186 17.9271 18.8173 18.1671 18.8489C18.693 18.9182 19.2249 18.7756 19.6457 18.4527C19.9613 18.2106 20.1943 17.807 20.6603 17C20.8677 16.6407 21.029 16.3614 21.1486 16.1272M20.3387 13.3608C19.8662 13.0639 19.5622 12.5581 19.5621 12.0001C19.5621 11.442 19.8662 10.9361 20.3387 10.6392C20.6603 10.4372 20.8674 10.2757 21.0148 10.0836C21.3377 9.66278 21.4802 9.13092 21.411 8.60502C21.3591 8.2106 21.1261 7.80708 20.6601 7.00005C20.1942 6.19301 19.9612 5.7895 19.6456 5.54732C19.2248 5.22441 18.6929 5.0819 18.167 5.15113C17.927 5.18274 17.6836 5.2814 17.3479 5.45883C16.8544 5.71964 16.2643 5.73004 15.781 5.45096C15.2977 5.1719 15.0117 4.6557 14.9909 4.09803C14.9767 3.71852 14.9404 3.45835 14.8478 3.23463C14.6448 2.74458 14.2554 2.35523 13.7654 2.15224C13.3978 2 12.9319 2 12 2C11.0681 2 10.6022 2 10.2346 2.15224C9.74458 2.35523 9.35523 2.74458 9.15224 3.23463C9.05958 3.45833 9.02332 3.71848 9.00912 4.09794C8.98826 4.65566 8.70225 5.17191 8.21891 5.45096C7.73557 5.73002 7.14548 5.71959 6.65205 5.4588C6.31633 5.28136 6.0729 5.18269 5.83285 5.15108C5.30695 5.08185 4.77509 5.22436 4.35427 5.54727C4.03866 5.78945 3.80569 6.19297 3.33974 7C3.13231 7.35929 2.97105 7.63859 2.85138 7.87273"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
              ></path>
            </g>
          </svg>
        </button>
        <div class="w-px bg-gray-700 mx-1"></div>
        <button
          onclick="setTimeScale(0)"
          id="btn-pause"
          class="time-btn w-10 h-10 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:border-gray-400 flex items-center justify-center"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
          </svg>
        </button>
        <button
          onclick="setTimeScale(1)"
          id="btn-play"
          class="time-btn active w-10 h-10 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:border-gray-400 flex items-center justify-center"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z" />
          </svg>
        </button>
        <button
          onclick="setTimeScale(3)"
          id="btn-fast"
          class="time-btn w-10 h-10 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:border-gray-400 flex items-center justify-center relative"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z" />
          </svg>
        </button>
      </div>

      <!-- Sandbox Control Panel (Bottom Left - replaces objectives in sandbox mode) -->
      <div
        id="sandboxPanel"
        class="hidden absolute bottom-24 left-4 glass-panel rounded-xl p-4 pointer-events-auto w-80"
      >
        <div
          class="flex justify-between items-center mb-3 border-b border-gray-700 pb-2"
        >
          <h3 class="text-sm font-bold text-purple-400">SANDBOX</h3>
          <button
            onclick="clearAllServices()"
            class="text-xs text-red-400 hover:text-red-300 px-2 py-1 border border-red-900 rounded"
          >
            Clear All
          </button>
        </div>

        <!-- BUDGET -->
        <div class="mb-3">
          <div class="text-xs text-gray-400 mb-1">Budget ($)</div>
          <div class="flex items-center gap-2">
            <input
              type="range"
              id="budget-slider"
              min="0"
              max="10000"
              step="100"
              value="2000"
              oninput="setSandboxBudget(this.value)"
              class="flex-1 h-2 bg-gray-700 rounded-lg accent-green-500"
            />
            <input
              type="number"
              id="budget-input"
              value="2000"
              min="0"
              onchange="setSandboxBudget(this.value)"
              class="w-20 px-2 py-1 bg-gray-800 border border-gray-600 rounded text-green-400 text-sm text-center font-mono"
            />
          </div>
          <div class="flex gap-2 mt-2">
            <button
              onclick="resetBudget()"
              class="flex-1 text-xs py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded"
            >
              Reset $
            </button>
            <button
              onclick="toggleUpkeep()"
              id="upkeep-toggle"
              class="flex-1 text-xs py-1.5 bg-green-900/50 text-gray-300 rounded border border-gray-600"
            >
              Upkeep: OFF
            </button>
          </div>
        </div>

        <!-- RPS -->
        <div class="mb-3">
          <div class="text-xs text-gray-400 mb-1">Traffic Rate (req/s)</div>
          <div class="flex items-center gap-2">
            <input
              type="range"
              id="rps-slider"
              min="0"
              max="50"
              step="0.5"
              value="1"
              oninput="setSandboxRPS(this.value)"
              class="flex-1 h-2 bg-gray-700 rounded-lg accent-blue-500"
            />
            <input
              type="number"
              id="rps-input"
              value="1"
              min="0"
              step="0.5"
              onchange="setSandboxRPS(this.value)"
              class="w-20 px-2 py-1 bg-gray-800 border border-gray-600 rounded text-blue-400 text-sm text-center font-mono"
            />
          </div>
        </div>

        <!-- TRAFFIC MIX -->
        <div class="mb-3">
          <div class="text-xs text-gray-400 mb-1">Traffic Mix (%)</div>
          <!-- STATIC -->
          <div class="flex items-center gap-2 mb-1">
            <span class="w-14 text-xs text-green-400">STATIC</span>
            <input
              type="range"
              id="static-slider"
              min="0"
              max="100"
              value="30"
              oninput="setTrafficMix('STATIC',this.value)"
              class="flex-1 h-1.5 bg-gray-700 rounded-lg accent-green-500"
            />
            <input
              type="number"
              id="static-input"
              value="30"
              min="0"
              max="100"
              onchange="setTrafficMix('STATIC',this.value)"
              class="w-14 px-1 py-0.5 bg-gray-800 border border-gray-600 rounded text-green-400 text-xs text-center font-mono"
            />
          </div>
          <!-- READ -->
          <div class="flex items-center gap-2 mb-1">
            <span class="w-14 text-xs text-blue-400">READ</span>
            <input
              type="range"
              id="read-slider"
              min="0"
              max="100"
              value="20"
              oninput="setTrafficMix('READ',this.value)"
              class="flex-1 h-1.5 bg-gray-700 rounded-lg accent-blue-500"
            />
            <input
              type="number"
              id="read-input"
              value="20"
              min="0"
              max="100"
              onchange="setTrafficMix('READ',this.value)"
              class="w-14 px-1 py-0.5 bg-gray-800 border border-gray-600 rounded text-blue-400 text-xs text-center font-mono"
            />
          </div>
          <!-- WRITE -->
          <div class="flex items-center gap-2 mb-1">
            <span class="w-14 text-xs text-orange-400">WRITE</span>
            <input
              type="range"
              id="write-slider"
              min="0"
              max="100"
              value="15"
              oninput="setTrafficMix('WRITE',this.value)"
              class="flex-1 h-1.5 bg-gray-700 rounded-lg accent-orange-500"
            />
            <input
              type="number"
              id="write-input"
              value="15"
              min="0"
              max="100"
              onchange="setTrafficMix('WRITE',this.value)"
              class="w-14 px-1 py-0.5 bg-gray-800 border border-gray-600 rounded text-orange-400 text-xs text-center font-mono"
            />
          </div>
          <!-- UPLOAD -->
          <div class="flex items-center gap-2 mb-1">
            <span class="w-14 text-xs text-yellow-400">UPLOAD</span>
            <input
              type="range"
              id="upload-slider"
              min="0"
              max="100"
              value="5"
              oninput="setTrafficMix('UPLOAD',this.value)"
              class="flex-1 h-1.5 bg-gray-700 rounded-lg accent-yellow-500"
            />
            <input
              type="number"
              id="upload-input"
              value="5"
              min="0"
              max="100"
              onchange="setTrafficMix('UPLOAD',this.value)"
              class="w-14 px-1 py-0.5 bg-gray-800 border border-gray-600 rounded text-yellow-400 text-xs text-center font-mono"
            />
          </div>
          <!-- SEARCH -->
          <div class="flex items-center gap-2 mb-1">
            <span class="w-14 text-xs text-cyan-400">SEARCH</span>
            <input
              type="range"
              id="search-slider"
              min="0"
              max="100"
              value="10"
              oninput="setTrafficMix('SEARCH',this.value)"
              class="flex-1 h-1.5 bg-gray-700 rounded-lg accent-cyan-500"
            />
            <input
              type="number"
              id="search-input"
              value="10"
              min="0"
              max="100"
              onchange="setTrafficMix('SEARCH',this.value)"
              class="w-14 px-1 py-0.5 bg-gray-800 border border-gray-600 rounded text-cyan-400 text-xs text-center font-mono"
            />
          </div>
          <!-- MALICIOUS -->
          <div class="flex items-center gap-2">
            <span class="w-14 text-xs text-red-400">ATTACK</span>
            <input
              type="range"
              id="malicious-slider"
              min="0"
              max="100"
              value="20"
              oninput="setTrafficMix('MALICIOUS',this.value)"
              class="flex-1 h-1.5 bg-gray-700 rounded-lg accent-red-500"
            />
            <input
              type="number"
              id="malicious-input"
              value="20"
              min="0"
              max="100"
              onchange="setTrafficMix('MALICIOUS',this.value)"
              class="w-14 px-1 py-0.5 bg-gray-800 border border-gray-600 rounded text-red-400 text-xs text-center font-mono"
            />
          </div>
        </div>

        <!-- BURST -->
        <div class="border-t border-gray-700 pt-2">
          <div class="flex items-center gap-2 mb-2">
            <span class="text-xs text-gray-400">Burst:</span>
            <input
              type="number"
              id="burst-input"
              value="10"
              min="1"
              onchange="setBurstCount(this.value)"
              class="w-16 px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-xs text-center font-mono"
            />
          </div>
          <div class="flex gap-1 flex-wrap">
            <button
              onclick="spawnBurst('STATIC')"
              class="flex-1 bg-green-900/50 hover:bg-green-800 text-green-400 text-xs py-1.5 rounded border border-green-700/50"
            >
              STATIC
            </button>
            <button
              onclick="spawnBurst('READ')"
              class="flex-1 bg-blue-900/50 hover:bg-blue-800 text-blue-400 text-xs py-1.5 rounded border border-blue-700/50"
            >
              READ
            </button>
            <button
              onclick="spawnBurst('WRITE')"
              class="flex-1 bg-orange-900/50 hover:bg-orange-800 text-orange-400 text-xs py-1.5 rounded border border-orange-700/50"
            >
              WRITE
            </button>
          </div>
          <div class="flex gap-1 flex-wrap mt-1">
            <button
              onclick="spawnBurst('UPLOAD')"
              class="flex-1 bg-yellow-900/50 hover:bg-yellow-800 text-yellow-400 text-xs py-1.5 rounded border border-yellow-700/50"
            >
              UPLOAD
            </button>
            <button
              onclick="spawnBurst('SEARCH')"
              class="flex-1 bg-cyan-900/50 hover:bg-cyan-800 text-cyan-400 text-xs py-1.5 rounded border border-cyan-700/50"
            >
              SEARCH
            </button>
            <button
              onclick="spawnBurst('MALICIOUS')"
              class="flex-1 bg-red-900/50 hover:bg-red-800 text-red-400 text-xs py-1.5 rounded border border-red-700/50"
            >
              DDoS
            </button>
          </div>
        </div>
      </div>

      <!-- Objective Panel (Bottom Left) -->
      <div
        id="objectivesPanel"
        class="absolute bottom-48 left-4 glass-panel rounded-xl p-4 pointer-events-auto max-w-xs"
      >
        <div class="flex justify-between items-center mb-2">
          <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">
            Current Objectives
          </h3>
          <span
            class="text-[10px] bg-red-900/50 px-2 py-0.5 rounded text-red-400 border border-red-800 animate-pulse"
            >LIVE</span
          >
        </div>
        <ul class="text-xs text-gray-300 space-y-2 font-mono">
          <li class="flex items-center">
            <span
              class="w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"
            ></span>
            Survive Endless Traffic
          </li>
          <li id="goal-storage" class="flex items-center">
            <span class="w-2 h-2 rounded-full bg-green-500 mr-2"></span>
            Route STATIC/UPLOAD ‚Üí Storage
          </li>
          <li id="goal-db" class="flex items-center">
            <span class="w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
            Route READ/WRITE/SEARCH ‚Üí Database
          </li>
          <li id="goal-waf" class="flex items-center">
            <span class="w-2 h-2 rounded-full bg-purple-500 mr-2"></span>
            Block MALICIOUS with Firewall
          </li>
        </ul>
      </div>
    </div>

    <!-- UI Overlay: Bottom Toolbar -->
    <div
      class="absolute bottom-6 left-0 w-full z-10 pointer-events-none flex justify-center"
    >
      <div
        class="glass-panel rounded-2xl p-2 pointer-events-auto overflow-y-auto flex items-center gap-2 shadow-2xl"
      >
        <!-- Help Button -->
        <button
          id="tool-help"
          class="service-btn bg-gray-700 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center mr-2 border border-gray-600"
          onclick="showFAQ()"
        >
          <div class="text-xl">?</div>
          <span class="text-[9px] font-bold mt-1 uppercase">Help</span>
        </button>

        <!-- Mute Button -->
        <button
          id="tool-mute"
          class="service-btn bg-gray-700 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-gray-600"
          onclick="toggleMute()"
        >
          <div class="text-xl" id="mute-icon">üîä</div>
          <span class="text-[9px] font-bold mt-1 uppercase">Sound</span>
        </button>

        <!-- Tools -->
        <div class="flex gap-1 pr-4 border-r border-gray-700">
          <button
            id="tool-select"
            class="service-btn active bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent"
            onclick="setTool('select')"
          >
            <svg
              class="w-6 h-6 mb-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"
              ></path>
            </svg>
            <span class="text-[10px] uppercase">Select</span>
          </button>

          <button
            id="tool-connect"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent"
            onclick="setTool('connect')"
          >
            <svg
              class="w-6 h-6 mb-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
              ></path>
            </svg>
            <span class="text-[10px] uppercase">Link</span>
          </button>

          <button
            id="tool-delete"
            class="service-btn bg-red-900/30 text-red-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent hover:bg-red-900/50"
            onclick="setTool('delete')"
          >
            <svg
              class="w-6 h-6 mb-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
              ></path>
            </svg>
            <span class="text-[10px] uppercase">Demolish</span>
          </button>

          <button
            id="tool-unlink"
            class="service-btn bg-orange-900/30 text-orange-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent hover:bg-orange-900/50"
            onclick="setTool('unlink')"
          >
            <svg
              class="w-6 h-6 mb-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
              ></path>
            </svg>
            <span class="text-[10px] uppercase">Unlink</span>
          </button>
        </div>

        <!-- Shop -->
        <div class="flex gap-2 pl-2 flex-wrap">
          <!-- Edge -->
          <button
            id="tool-edge"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('edge')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $30
            </div>
            <div
              class="w-4 h-4 bg-teal-400 rounded mb-1 shadow-[0_0_10px_rgba(45,212,191,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">Edge</span>
          </button>

          <!-- Firewall -->
          <button
            id="tool-waf"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('waf')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $40
            </div>
            <div
              class="w-4 h-4 bg-purple-500 rounded-sm mb-1 shadow-[0_0_10px_rgba(168,85,247,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">Firewall</span>
          </button>

          <!-- Proxy -->
          <button
            id="tool-alb"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('alb')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $50
            </div>
            <div
              class="w-4 h-4 bg-blue-500 rounded-sm mb-1 shadow-[0_0_10px_rgba(59,130,246,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">Proxy</span>
          </button>

          <!-- Content Scanning -->
          <button
            id="tool-content"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('content')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $55
            </div>
            <div
              class="w-4 h-4 bg-amber-400 rounded mb-1 shadow-[0_0_10px_rgba(251,191,36,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1 text-center leading-tight"
              >Content</span
            >
          </button>

          <!-- Cyber Intelligence -->
          <button
            id="tool-intel"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('intel')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $70
            </div>
            <div
              class="w-4 h-4 bg-violet-400 rounded mb-1 shadow-[0_0_10px_rgba(167,139,250,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1 text-center leading-tight"
              >Intel</span
            >
          </button>

          <!-- SQS -->
          <button
            id="tool-sqs"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('sqs')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $40
            </div>
            <div
              class="w-5 h-3 bg-orange-500 rounded-sm mb-1 shadow-[0_0_10px_rgba(255,153,0,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">Queue</span>
          </button>

          <!-- Compute -->
          <button
            id="tool-lambda"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('lambda')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $60
            </div>
            <div
              class="w-4 h-4 bg-orange-500 rounded-full mb-1 shadow-[0_0_10px_rgba(249,115,22,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">Compute</span>
          </button>

          <!-- Database -->
          <button
            id="tool-db"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('db')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $150
            </div>
            <div
              class="w-4 h-4 bg-red-600 rounded-sm mb-1 shadow-[0_0_10px_rgba(220,38,38,0.6)] border-b-2 border-red-800"
            ></div>
            <span class="text-[10px] font-bold mt-1">Database</span>
          </button>

          <!-- Cache -->
          <button
            id="tool-cache"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('cache')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $60
            </div>
            <div
              class="w-4 h-4 bg-red-600 rounded mb-1 shadow-[0_0_10px_rgba(220,56,45,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">Cache</span>
          </button>

          <!-- S3 -->
          <button
            id="tool-s3"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('s3')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $25
            </div>
            <div
              class="w-4 h-4 bg-emerald-500 rounded-full mb-1 shadow-[0_0_10px_rgba(16,185,129,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">Storage</span>
          </button>

          <!-- SIEM -->
          <button
            id="tool-siem"
            class="service-btn bg-gray-800 text-gray-200 p-2 rounded-lg w-16 h-16 flex flex-col items-center justify-center border border-transparent group relative overflow-hidden"
            onclick="setTool('siem')"
          >
            <div
              class="absolute top-0 right-0 bg-green-900/80 text-green-400 text-[9px] px-1 rounded-bl font-mono"
            >
              $80
            </div>
            <div
              class="w-4 h-4 bg-cyan-300 rounded mb-1 shadow-[0_0_10px_rgba(103,232,249,0.6)]"
            ></div>
            <span class="text-[10px] font-bold mt-1">SIEM</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Hover Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <!-- Game Canvas -->
    <div id="canvas-container"></div>

    <!-- End/Next Level Modal -->
    <div
      id="modal"
      class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center backdrop-blur-sm"
    >
      <div
        class="glass-panel p-8 rounded-2xl text-center max-w-md border border-gray-600"
      >
        <h2
          id="modal-title"
          class="text-4xl font-bold mb-4 text-white font-mono tracking-tighter"
        >
          SYSTEM FAILURE
        </h2>
        <div class="h-px w-full bg-gray-700 mb-6"></div>
        <p id="modal-desc" class="text-gray-300 mb-8 text-sm leading-relaxed">
          Infrastructure collapsed.
        </p>
        <div class="flex justify-center gap-4">
          <button
            onclick="retryWithSameArchitecture()"
            class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform transition hover:scale-105 font-mono uppercase text-sm"
          >
            Retry Same Setup
          </button>
          <button
            onclick="restartGame()"
            class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform transition hover:scale-105 font-mono uppercase text-sm"
          >
            Start Fresh
          </button>
        </div>
      </div>
    </div>

    <!-- Main Menu Modal -->
    <div
      id="main-menu-modal"
      class="absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"
    >
      <div
        class="relative bg-gray-900/90 p-12 rounded-2xl border border-blue-500/30 shadow-2xl max-w-md w-full text-center"
      >
        <!-- Menu Mute Button -->
        <button
          id="menu-mute-btn"
          onclick="toggleMute()"
          class="absolute top-4 right-4 text-gray-400 hover:text-white transition p-2 rounded-full pulse-green"
        >
          <span id="menu-mute-icon" class="text-xl">üîá</span>
        </button>

        <h1
          class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300 mb-6 tracking-tighter filter drop-shadow-[0_0_10px_rgba(59,130,246,0.5)]"
        >
          SECURITY<br />SURVIVAL by Gen0Sec
        </h1>

        <div class="space-y-4">
          <button
            id="auth-btn"
            onclick="openAuthModal()"
            class="supabase-only w-full bg-yellow-600 hover:bg-yellow-500 text-black font-bold py-4 px-8 rounded-lg shadow-lg transition hover:scale-105 font-mono uppercase uppercase text-lg border border-yellow-400/50 text-white"
          >
            Sign In / Register
          </button>
          <button
            id="sign-out-btn"
            onclick="logoutUser()"
            class="supabase-only hidden w-full bg-yellow-600 hover:bg-yellow-500 text-black font-bold py-4 px-8 rounded-lg shadow-lg transition hover:scale-105 font-mono uppercase uppercase text-lg border border-yellow-400/50 text-white"
          >
            Sign out
          </button>
          <button
            id="resume-btn"
            onclick="resumeGame()"
            class="hidden w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform transition hover:scale-105 font-mono uppercase text-lg border border-blue-400/50"
          >
            Resume Game
          </button>

          <button
            onclick="startGame()"
            class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform transition hover:scale-105 font-mono uppercase text-lg border border-green-400/50"
          >
            Start Survival
          </button>

          <button
            onclick="startSandbox()"
            class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform transition hover:scale-105 font-mono uppercase text-lg border border-purple-400/50"
          >
            Sandbox Mode
          </button>

          <button
            onclick="loadGameState()"
            id="load-btn"
            class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform transition hover:scale-105 font-mono uppercase text-lg border border-cyan-400/50"
          >
            Continue Game
          </button>

          <button
            onclick="openLeaderboard()"
            id="load-btn"
            class="supabase-only w-full bg-red-600 hover:bg-red-500 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform transition hover:scale-105 font-mono uppercase text-lg border border-red-400/50"
          >
            Leaderboard
          </button>

          <button
            onclick="showFAQ()"
            class="w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold py-3 px-8 rounded-lg border border-gray-600 transition hover:text-white font-mono uppercase"
          >
            Manual / FAQ
          </button>
        </div>

        <div class="mt-8 text-xs text-gray-500 font-mono"></div>
      </div>
    </div>

    <!-- Auth overlay -->
    <div
      id="auth-modal"
      class="hidden absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"
    >
      <div
        class="relative bg-gray-900/90 p-10 rounded-2xl border border-blue-500/30 shadow-2xl max-w-md w-full text-center"
      >
        <button
          onclick="closeAuthModal()"
          class="absolute top-4 right-4 text-gray-400 hover:text-white"
        >
          ‚úï
        </button>

        <h2
          id="auth-title"
          class="text-3xl font-bold mb-6 text-cyan-300 font-mono"
        >
          Sign In
        </h2>

        <!-- OAuth -->
        <div class="w-full h-fit mb-3 flex space-x-2">
          <button
            onclick="oauthLogin('discord')"
            class="flex w-1/3 items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 640 512"
              class="w-8 h-8 text-white"
            >
              <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M524.5 69.8a1.5 1.5 0 0 0 -.8-.7A485.1 485.1 0 0 0 404.1 32a1.8 1.8 0 0 0 -1.9 .9 337.5 337.5 0 0 0 -14.9 30.6 447.8 447.8 0 0 0 -134.4 0 309.5 309.5 0 0 0 -15.1-30.6 1.9 1.9 0 0 0 -1.9-.9A483.7 483.7 0 0 0 116.1 69.1a1.7 1.7 0 0 0 -.8 .7C39.1 183.7 18.2 294.7 28.4 404.4a2 2 0 0 0 .8 1.4A487.7 487.7 0 0 0 176 479.9a1.9 1.9 0 0 0 2.1-.7A348.2 348.2 0 0 0 208.1 430.4a1.9 1.9 0 0 0 -1-2.6 321.2 321.2 0 0 1 -45.9-21.9 1.9 1.9 0 0 1 -.2-3.1c3.1-2.3 6.2-4.7 9.1-7.1a1.8 1.8 0 0 1 1.9-.3c96.2 43.9 200.4 43.9 295.5 0a1.8 1.8 0 0 1 1.9 .2c2.9 2.4 6 4.9 9.1 7.2a1.9 1.9 0 0 1 -.2 3.1 301.4 301.4 0 0 1 -45.9 21.8 1.9 1.9 0 0 0 -1 2.6 391.1 391.1 0 0 0 30 48.8 1.9 1.9 0 0 0 2.1 .7A486 486 0 0 0 610.7 405.7a1.9 1.9 0 0 0 .8-1.4C623.7 277.6 590.9 167.5 524.5 69.8zM222.5 337.6c-29 0-52.8-26.6-52.8-59.2S193.1 219.1 222.5 219.1c29.7 0 53.3 26.8 52.8 59.2C275.3 311 251.9 337.6 222.5 337.6zm195.4 0c-29 0-52.8-26.6-52.8-59.2S388.4 219.1 417.9 219.1c29.7 0 53.3 26.8 52.8 59.2C470.7 311 447.5 337.6 417.9 337.6z"
                fill="white"
              ></path>
            </svg>
          </button>
          <button
            onclick="oauthLogin('google')"
            class="flex w-1/3 items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg items-center justify-center"
          >
            <svg
              class="w-8 h-8 text-white"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 488 512"
            >
              <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path
                d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"
                fill="white"
              ></path>
            </svg>
          </button>
          <button
            onclick="oauthLogin('github')"
            class="flex w-1/3 items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg items-center justify-center"
          >
            <svg
              viewBox="0 0 20 20"
              version="1.1"
              class="w-8 h-8 text-white"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              fill="#000000"
            >
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g
                id="SVGRepo_tracerCarrier"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></g>
              <g id="SVGRepo_iconCarrier">
                <title>github [#FFFFFF142]</title>
                <desc>Created with Sketch.</desc>
                <defs></defs>
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g
                    id="Dribbble-Light-Preview"
                    transform="translate(-140.000000, -7559.000000)"
                    fill="#FFFFFF"
                  >
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                      <path
                        d="M94,7399 C99.523,7399 104,7403.59 104,7409.253 C104,7413.782 101.138,7417.624 97.167,7418.981 C96.66,7419.082 96.48,7418.762 96.48,7418.489 C96.48,7418.151 96.492,7417.047 96.492,7415.675 C96.492,7414.719 96.172,7414.095 95.813,7413.777 C98.04,7413.523 100.38,7412.656 100.38,7408.718 C100.38,7407.598 99.992,7406.684 99.35,7405.966 C99.454,7405.707 99.797,7404.664 99.252,7403.252 C99.252,7403.252 98.414,7402.977 96.505,7404.303 C95.706,7404.076 94.85,7403.962 94,7403.958 C93.15,7403.962 92.295,7404.076 91.497,7404.303 C89.586,7402.977 88.746,7403.252 88.746,7403.252 C88.203,7404.664 88.546,7405.707 88.649,7405.966 C88.01,7406.684 87.619,7407.598 87.619,7408.718 C87.619,7412.646 89.954,7413.526 92.175,7413.785 C91.889,7414.041 91.63,7414.493 91.54,7415.156 C90.97,7415.418 89.522,7415.871 88.63,7414.304 C88.63,7414.304 88.101,7413.319 87.097,7413.247 C87.097,7413.247 86.122,7413.234 87.029,7413.87 C87.029,7413.87 87.684,7414.185 88.139,7415.37 C88.139,7415.37 88.726,7417.2 91.508,7416.58 C91.513,7417.437 91.522,7418.245 91.522,7418.489 C91.522,7418.76 91.338,7419.077 90.839,7418.982 C86.865,7417.627 84,7413.783 84,7409.253 C84,7403.59 88.478,7399 94,7399"
                        id="github-[#FFFFFF142]"
                      ></path>
                    </g>
                  </g>
                </g>
              </g>
            </svg>
          </button>
        </div>

        <div class="text-gray-500 text-sm my-4">or</div>

        <!-- Email / Password -->
        <form onsubmit="submitAuth(event)" class="space-y-4">
          <input
            id="auth-email"
            type="email"
            placeholder="Email"
            required
            class="rounded-lg w-full h-8 px-4 py-2 border-2 border-blue-600 focus:outline-none focus:ring-0 focus:border-cyan-400"
          />
          <input
            id="auth-password"
            type="password"
            placeholder="Password"
            required
            class="rounded-lg w-full h-8 px-4 py-2 border-2 border-blue-600 focus:outline-none focus:ring-0 focus:border-cyan-400"
          />
          <p id="error-msg" class="text-sm text-red-400 hidden">
            Wrong email or password!
          </p>

          <button
            id="auth-submit-btn"
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg"
          >
            Sign In
          </button>
        </form>

        <button
          id="toggle-auth-btn"
          onclick="toggleAuthMode()"
          class="mt-4 text-sm text-gray-400 hover:text-white"
        >
          Don‚Äôt have an account? Sign up
        </button>
      </div>
    </div>

    <!-- LEADERBOARD OVERLAY -->
    <div
      id="leaderboard-modal"
      class="hidden absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"
    >
      <div
        class="relative bg-gray-900/90 p-8 rounded-2xl border border-cyan-500/30 shadow-2xl max-w-lg w-full"
      >
        <!-- Close -->
        <button
          onclick="closeLeaderboard()"
          class="absolute top-4 right-4 text-gray-400 hover:text-white"
        >
          ‚úï
        </button>

        <h2
          class="text-3xl font-black text-cyan-300 mb-4 font-mono text-center"
        >
          LEADERBOARD
        </h2>

        <!-- Search -->
        <input
          id="leaderboard-search"
          type="text"
          placeholder="Search by email..."
          oninput="searchLeaderboard(this.value)"
          class="w-full mb-4 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-cyan-400"
        />

        <!-- Scores -->
        <div
          id="leaderboard-list"
          class="space-y-2 max-h-80 overflow-y-auto font-mono text-sm"
        >
          <!-- rows injected here -->
        </div>
      </div>
    </div>

    <!-- Tutorial Modal (no backdrop - allows interaction with game) -->
    <div
      id="tutorial-modal"
      class="fixed inset-0 z-[60] pointer-events-none hidden"
    >
      <!-- Tutorial popup -->
      <div
        id="tutorial-popup"
        class="absolute glass-panel rounded-xl p-6 max-w-xl pointer-events-auto border-2 border-cyan-500/50 shadow-[0_0_30px_rgba(6,182,212,0.3)]"
      >
        <div class="flex items-center gap-3 mb-4">
          <div
            id="tutorial-icon"
            class="w-12 h-12 rounded-lg flex items-center justify-center text-2xl bg-cyan-900/50 border border-cyan-500/30"
          ></div>
          <div>
            <h3 id="tutorial-title" class="text-lg font-bold text-white"></h3>
            <div class="text-xs text-gray-400">
              Step <span id="tutorial-step-num">1</span> of
              <span id="tutorial-total-steps">10</span>
            </div>
          </div>
        </div>

        <p
          id="tutorial-text"
          class="text-gray-300 text-sm leading-relaxed mb-4"
        ></p>

        <div
          id="tutorial-hint"
          class="bg-gray-800/50 rounded-lg p-3 mb-4 border border-gray-700 hidden"
        >
          <div class="flex items-start gap-2">
            <span class="text-yellow-400">üí°</span>
            <p id="tutorial-hint-text" class="text-xs text-gray-400"></p>
          </div>
        </div>

        <div class="flex justify-between items-center">
          <button
            id="tutorial-skip"
            class="text-gray-500 hover:text-gray-300 text-sm transition"
            onclick="window.tutorial?.skip()"
          >
            Skip Tutorial
          </button>
          <div class="flex gap-2">
            <button
              id="tutorial-next"
              class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg transition hidden"
            >
              Next
            </button>
          </div>
        </div>

        <!-- Progress dots -->
        <div
          id="tutorial-progress"
          class="flex justify-center gap-1.5 mt-4 pt-3 border-t border-gray-700"
        ></div>
      </div>

      <!-- Highlight ring for elements -->
      <div
        id="tutorial-highlight"
        class="absolute pointer-events-none border-2 border-cyan-400 rounded-xl shadow-[0_0_20px_rgba(6,182,212,0.5)] hidden"
        style="transition: all 0.3s ease"
      ></div>
    </div>

    <!-- SETTINGS MODAL -->
    <div
      id="settings-modal"
      class="hidden absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"
    >
      <div
        class="relative bg-gray-900/90 p-8 rounded-2xl border border-cyan-500/30 shadow-2xl max-w-md w-full"
      >
        <!-- Close -->
        <button
          onclick="closeSettings()"
          class="absolute top-4 right-4 text-gray-400 hover:text-white"
        >
          ‚úï
        </button>

        <h2
          class="text-2xl font-black text-cyan-300 mb-6 font-mono text-center"
        >
          SETTINGS
        </h2>

        <!-- OpenAI Key -->
        <label
          for="openai-key-input"
          class="block text-sm text-gray-400 mb-2 font-mono"
        >
          OpenAI API Key
        </label>

        <input
          id="openai-key-input"
          type="text"
          placeholder="sk-..."
          class="w-full mb-6 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-cyan-400 font-mono"
        />

        <!-- Save -->
        <button
          onclick="saveSettings()"
          class="w-full bg-cyan-600 hover:bg-cyan-500 text-black font-bold py-3 rounded-lg shadow-lg transition hover:scale-105 font-mono uppercase"
        >
          Save Settings
        </button>

        <!-- Feedback -->
        <div
          id="settings-feedback"
          class="mt-4 text-sm text-green-400 text-center hidden font-mono"
        >
          Settings saved
        </div>
      </div>
    </div>

    <!-- FAQ Modal -->
    <div
      id="faq-modal"
      class="fixed inset-0 bg-black/95 flex items-center justify-center z-50 hidden"
    >
      <div
        class="glass-panel p-8 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700"
      >
        <div
          class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4"
        >
          <h2 class="text-2xl font-bold text-white">OPERATOR MANUAL</h2>
          <button onclick="closeFAQ()" class="text-gray-400 hover:text-white">
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- Traffic Types -->
          <div>
            <h3 class="text-lg font-bold text-blue-400 mb-4">TRAFFIC TYPES</h3>
            <div class="space-y-3">
              <div
                class="bg-gray-800/50 p-3 rounded border border-green-900/50"
              >
                <strong class="text-green-400">STATIC (GET)</strong>
                <p class="text-sm text-gray-400">
                  Images, CSS, JS. Route to
                  <span class="text-emerald-400">Storage</span>. 90% cache hit
                  rate.
                </p>
              </div>
              <div class="bg-gray-800/50 p-3 rounded border border-blue-900/50">
                <strong class="text-blue-400">READ (GET)</strong>
                <p class="text-sm text-gray-400">
                  API data fetch. Route to
                  <span class="text-red-400">SQL DB</span>. 40% cache hit rate.
                </p>
              </div>
              <div
                class="bg-gray-800/50 p-3 rounded border border-orange-900/50"
              >
                <strong class="text-orange-400">WRITE (POST/PUT)</strong>
                <p class="text-sm text-gray-400">
                  Database writes. Route to
                  <span class="text-red-400">SQL DB</span>. Never cached.
                </p>
              </div>
              <div
                class="bg-gray-800/50 p-3 rounded border border-yellow-900/50"
              >
                <strong class="text-yellow-400">UPLOAD (POST)</strong>
                <p class="text-sm text-gray-400">
                  File uploads. Route to
                  <span class="text-emerald-400">Storage</span>. Never cached.
                  Heavy processing.
                </p>
              </div>
              <div class="bg-gray-800/50 p-3 rounded border border-cyan-900/50">
                <strong class="text-cyan-400">SEARCH (GET)</strong>
                <p class="text-sm text-gray-400">
                  Complex queries. Route to
                  <span class="text-red-400">SQL DB</span>. 15% cache hit. Heavy
                  processing.
                </p>
              </div>
              <div class="bg-gray-800/50 p-3 rounded border border-red-900/50">
                <strong class="text-red-400">MALICIOUS</strong>
                <p class="text-sm text-gray-400">
                  DDoS & attacks. Block with
                  <span class="text-purple-400">Firewall</span>.
                </p>
              </div>
            </div>
          </div>

          <!-- Services -->
          <div>
            <h3 class="text-lg font-bold text-blue-400 mb-4">SERVICES</h3>
            <ul class="space-y-2 text-sm text-gray-300">
              <li class="flex justify-between">
                <span class="text-purple-400 font-bold">Firewall</span>
                <span>Blocks Fraud ($40)</span>
              </li>
              <li class="flex justify-between">
                <span class="text-orange-500 font-bold">Message Queue</span>
                <span>Buffers 200 requests ($35)</span>
              </li>
              <li class="flex justify-between">
                <span class="text-blue-400 font-bold">Load Balancer</span>
                <span>Distributes Traffic ($50)</span>
              </li>
              <li class="flex justify-between">
                <span class="text-orange-400 font-bold">Compute</span>
                <span>Processes Requests ($60)</span>
              </li>
              <li class="flex justify-between">
                <span class="text-red-400 font-bold">Relational DB</span>
                <span>Stores API Data ($150)</span>
              </li>
              <li class="flex justify-between">
                <span class="text-red-500 font-bold">Memory Cache</span>
                <span>Cache layer ($60)</span>
              </li>
              <li class="flex justify-between">
                <span class="text-emerald-400 font-bold">File Storage</span>
                <span>Stores Web Data ($25)</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Tools -->
        <div class="mt-8">
          <h3 class="text-lg font-bold text-blue-400 mb-4">TOOLS & CONTROLS</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div class="bg-gray-800/30 p-3 rounded border border-gray-700">
              <div class="flex items-center mb-2">
                <div
                  class="w-6 h-6 bg-blue-600 rounded flex items-center justify-center mr-2"
                >
                  <svg
                    class="w-4 h-4 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"
                    ></path>
                  </svg>
                </div>
                <strong class="text-white">SELECT</strong>
              </div>
              <p class="text-gray-400">
                Inspect services to see load and stats. Click Compute/DB to
                upgrade.
              </p>
            </div>
            <div class="bg-gray-800/30 p-3 rounded border border-gray-700">
              <div class="flex items-center mb-2">
                <div
                  class="w-6 h-6 bg-gray-700 rounded flex items-center justify-center mr-2"
                >
                  <svg
                    class="w-4 h-4 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                    ></path>
                  </svg>
                </div>
                <strong class="text-white">CONNECT</strong>
              </div>
              <p class="text-gray-400">
                Link nodes together. Click
                <span class="text-green-400">Source</span> then
                <span class="text-blue-400">Destination</span>.
              </p>
            </div>
            <div class="bg-gray-800/30 p-3 rounded border border-gray-700">
              <div class="flex items-center mb-2">
                <div
                  class="w-6 h-6 bg-red-900/50 rounded flex items-center justify-center mr-2"
                >
                  <svg
                    class="w-4 h-4 text-red-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                    ></path>
                  </svg>
                </div>
                <strong class="text-white">DELETE</strong>
              </div>
              <p class="text-gray-400">Remove services. Refunds 50% of cost.</p>
            </div>
            <div class="bg-gray-800/30 p-3 rounded border border-gray-700">
              <div class="flex items-center mb-2">
                <div
                  class="w-6 h-6 bg-orange-900/50 rounded flex items-center justify-center mr-2"
                >
                  <svg
                    class="w-4 h-4 text-orange-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
                    ></path>
                  </svg>
                </div>
                <strong class="text-white">UNLINK</strong>
              </div>
              <p class="text-gray-400">
                Remove connections between services. Click on a link to delete
                it.
              </p>
            </div>

            <div class="bg-gray-800/30 p-3 rounded border border-gray-700">
              <div class="flex items-center mb-2">
                <strong class="text-white">HUD</strong>
              </div>
              <p class="text-gray-400">Press H for hiding HUD.</p>
            </div>

            <div class="bg-gray-800/30 p-3 rounded border border-gray-700">
              <div class="flex items-center mb-2">
                <strong class="text-white">View</strong>
              </div>
              <p class="text-gray-400">Press R for reset view.</p>
            </div>
          </div>
        </div>

        <!-- Mechanics -->
        <div class="mt-8">
          <h3 class="text-lg font-bold text-blue-400 mb-4">MECHANICS</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div class="bg-gray-800/30 p-3 rounded">
              <strong class="text-white block mb-1">Upgrades</strong>
              <p class="text-gray-400">
                Click existing Compute/DB/Cache instances to upgrade capacity
                (Tier 1-3).
              </p>
            </div>
            <div class="bg-gray-800/30 p-3 rounded">
              <strong class="text-white block mb-1">Load Balancing</strong>
              <p class="text-gray-400">
                Load Balancers use Round Robin to distribute traffic evenly.
              </p>
            </div>
            <div class="bg-gray-800/30 p-3 rounded">
              <strong class="text-white block mb-1">Failure Conditions</strong>
              <p class="text-gray-400">
                Reputation reaches 0% or Money reaches -$1000.
              </p>
            </div>
          </div>
        </div>

        <!-- Advanced Services -->
        <div class="mt-8">
          <h3 class="text-lg font-bold text-blue-400 mb-4">
            ADVANCED SERVICES
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div class="bg-gray-800/30 p-3 rounded border border-orange-900/50">
              <strong class="text-orange-400 block mb-1">Message Queue</strong>
              <p class="text-gray-400 text-xs">
                Massive buffer holding 200 requests. Place after Firewall to
                smooth DDoS spikes, or before Compute to prevent overload. Cheap
                insurance against traffic bursts.
              </p>
              <p class="text-gray-500 text-xs mt-1">
                Flow: Firewall ‚Üí Queue ‚Üí Load Balancer or Load Balancer ‚Üí Queue
                ‚Üí Compute
              </p>
            </div>
            <div class="bg-gray-800/30 p-3 rounded border border-red-900/50">
              <strong class="text-red-400 block mb-1">Memory Cache</strong>
              <p class="text-gray-400 text-xs">
                Caching layer with 35-65% hit rate. Cache hits complete
                instantly without hitting DB/Storage. Upgrade tiers for higher
                hit rates. Great for reducing DB costs.
              </p>
              <p class="text-gray-500 text-xs mt-1">
                Flow: Compute ‚Üí Cache ‚Üí DB/Storage
              </p>
            </div>
          </div>
        </div>

        <div class="mt-8 text-center">
          <button
            onclick="closeFAQ()"
            class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-8 rounded-lg transition"
          >
            Close Manual
          </button>
        </div>
      </div>
    </div>
    <script src="src/config.js"></script>
    <script src="src/state.js"></script>
    <script src="src/entities/Request.js"></script>
    <script src="src/entities/Service.js"></script>
    <script src="src/services/SoundService.js"></script>
    <script src="src/tutorial.js"></script>
    <script src="game.js" defer></script>
    <script src="main.js"></script>
  </body>
</html>
